<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayuka Yamo App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .transition-all { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Authentication Screen -->
    <div id="auth-screen" class="max-w-md mx-auto bg-white min-h-screen flex flex-col justify-center p-6">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Ayuka Yamo</h1>
            <p class="text-gray-600 text-sm">Natural Healing & Wellness Platform</p>
        </div>

        <!-- Login Form -->
        <div id="login-form" class="space-y-4">
            <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">Welcome Back</h2>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email or Phone</label>
                <input type="text" id="login-email" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter email or phone">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="login-password" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter password">
            </div>
            <button onclick="login()" class="w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700">Login</button>
            <div class="text-center">
                <button onclick="showSignup()" class="text-green-600 text-sm hover:text-green-700">Don't have an account? Sign up</button>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signup-form" class="space-y-4 hidden">
            <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">Create Account</h2>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                <input type="text" id="signup-name" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Your full name">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                <input type="email" id="signup-email" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Your email">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                <input type="tel" id="signup-phone" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Your phone">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                <input type="password" id="signup-password" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Create password">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Referral Code (Optional)</label>
                <input type="text" id="signup-referral" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter referral code">
                <p class="text-xs text-green-600 mt-1">Get 25 iKb welcome bonus!</p>
            </div>
            <button onclick="signup()" class="w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700">Create Account</button>
            <div class="text-center">
                <button onclick="showLogin()" class="text-green-600 text-sm hover:text-green-700">Already have account? Login</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="max-w-md mx-auto bg-gray-50 min-h-screen relative hidden">
        <!-- Header -->
        <div class="bg-white border-b border-gray-200 px-4 py-3">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Ayuka Yamo</h1>
                    <p class="text-xs text-gray-500">A subsidiary of Valentor Holdings Ltd.</p>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="text-xs text-gray-600" id="user-greeting">Hi User!</span>
                    <button onclick="toggleMenu()">
                        <span id="menu-icon">‚ò∞</span>
                        <span id="close-icon" class="hidden">‚úï</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Welcome Guide -->
        <div id="welcome-guide" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg w-full max-w-md p-6 text-center">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Welcome to Ayuka Yamo!</h3>
                <p class="text-gray-600 mb-6">Choose your wellness path:</p>
                <div class="space-y-4">
                    <button onclick="chooseProducts(); closeWelcome();" class="w-full bg-green-600 text-white p-4 rounded-lg hover:bg-green-700">
                        <div class="text-2xl mb-2">üì¶</div>
                        <div class="font-medium">Buy Products</div>
                        <div class="text-sm text-green-100">Individual products for specific conditions</div>
                    </button>
                    <button onclick="chooseTreatment(); closeWelcome();" class="w-full bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700">
                        <div class="text-2xl mb-2">ü©∫</div>
                        <div class="font-medium">Full Treatment Process</div>
                        <div class="text-sm text-purple-100">Complete 4-stage therapy with doctors</div>
                    </button>
                </div>
                <button onclick="closeWelcome()" class="mt-4 text-gray-500 text-sm">I'll decide later</button>
            </div>
        </div>

        <!-- Sliding Menu -->
        <div id="sliding-menu" class="fixed inset-0 z-50 bg-black bg-opacity-50 hidden" onclick="closeMenu()">
            <div class="bg-white w-64 h-full p-4" onclick="event.stopPropagation()">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-bold text-gray-800">Menu</h2>
                    <button onclick="closeMenu()">‚úï</button>
                </div>
                <nav class="space-y-2" id="nav-items"></nav>
                <div class="absolute bottom-4 w-56">
                    <button onclick="logout()" class="w-full bg-red-600 text-white py-2 rounded-lg text-sm hover:bg-red-700">Logout</button>
                </div>
            </div>
        </div>

        <!-- Advertising Modal -->
        <div id="advertising-modal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg w-full max-w-md">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Advertise & Earn</h3>
                        <button onclick="closeAdvertising()">‚úï</button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <h4 class="font-medium text-green-800 mb-2">Earn Kabiru Points</h4>
                        <p class="text-sm text-green-700">Share on social media and earn points!</p>
                    </div>
                    <div class="space-y-3">
                        <button onclick="shareToFacebook()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700">üìò Facebook (+20 iKb)</button>
                        <button onclick="shareToTwitter()" class="w-full bg-sky-500 text-white py-3 rounded-lg hover:bg-sky-600">üê¶ Twitter (+15 iKb)</button>
                        <button onclick="shareToWhatsApp()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600">üí¨ WhatsApp (+25 iKb)</button>
                        <button onclick="shareToInstagram()" class="w-full bg-pink-600 text-white py-3 rounded-lg hover:bg-pink-700">üì∏ Instagram (+20 iKb)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Consultation Modal -->
        <div id="consultation-modal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Consultation</h3>
                        <button onclick="closeConsultForm()">‚úï</button>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">Product: <span id="selected-product-name"></span> - KSh 10,000</p>
                </div>
                <div class="p-4 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" id="consult-fullname" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter name" oninput="updateConsultSubmitButton()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contact *</label>
                        <input type="tel" id="consult-contact" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Phone" oninput="updateConsultSubmitButton()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Doctor</label>
                        <select id="consult-doctor" class="w-full border border-gray-300 rounded-lg p-3">
                            <option value="">Select doctor</option>
                            <option value="HDr Magero Asa Rateng">HDr Magero Asa Rateng</option>
                            <option value="HDr Kaigi">HDr Kaigi</option>
                            <option value="HDr Orudi Aywak">HDr Orudi Aywak</option>
                            <option value="HDr Adenga Ayanga">HDr Adenga Ayanga</option>
                            <option value="HDr Akoth Syambua">HDr Akoth Syambua</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                            <input type="date" id="consult-date" class="w-full border border-gray-300 rounded-lg p-3">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                            <select id="consult-time" class="w-full border border-gray-300 rounded-lg p-3">
                                <option value="">Time</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Symptoms</label>
                        <textarea id="consult-symptoms" class="w-full border border-gray-300 rounded-lg p-3 h-20" placeholder="Describe concerns..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Urgency</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setUrgency('Low')" id="urgency-low" class="border border-gray-300 rounded-lg p-2 text-sm">Low</button>
                            <button onclick="setUrgency('Medium')" id="urgency-medium" class="border border-gray-300 rounded-lg p-2 text-sm">Medium</button>
                            <button onclick="setUrgency('High')" id="urgency-high" class="border border-gray-300 rounded-lg p-2 text-sm">High</button>
                        </div>
                    </div>
                    <button onclick="submitConsultation()" id="submit-consult-btn" class="w-full bg-gray-400 text-white py-3 rounded-lg font-medium cursor-not-allowed" disabled>Book Appointment</button>
                </div>
            </div>
        </div>

        <!-- ChatBot -->
        <div id="chatbot" class="fixed bottom-20 right-4 w-80 h-96 bg-white border border-gray-200 rounded-lg shadow-lg z-40 flex flex-col hidden">
            <div class="bg-green-600 text-white p-3 rounded-t-lg flex items-center justify-between">
                <h4 class="font-medium">üí¨ Assistant</h4>
                <button onclick="toggleChatbot()">‚úï</button>
            </div>
            <div class="flex-1 overflow-y-auto p-3 space-y-2" id="chat-messages"></div>
            <div class="p-3 border-t border-gray-200">
                <div class="flex space-x-2">
                    <input type="text" id="chat-input" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm" placeholder="Type message..." onkeypress="handleChatKeyPress(event)">
                    <button onclick="sendChatMessage()" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700">üì§</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="p-4 pb-20" id="main-content"></div>

        <!-- Floating Buttons -->
        <div class="fixed bottom-24 right-4 space-y-2 z-30">
            <button onclick="showAdvertising()" class="bg-orange-600 text-white p-3 rounded-full shadow-lg hover:bg-orange-700">üì¢</button>
            <button onclick="toggleChatbot()" class="bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700">üí¨</button>
        </div>

        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-200">
            <div class="grid grid-cols-4 gap-1 p-2" id="bottom-nav"></div>
        </div>
    </div>

    <script>
        // Application State
        let state = {
            isAuthenticated: false,
            activeTab: 'home',
            isMenuOpen: false,
            showWelcome: false,
            selectedProduct: '',
            selectedUrgency: '',
            userChoice: '',
            chatMessages: [{ sender: 'bot', message: "Hello! I'm your Ayuka Yamo assistant. How can I help you today?" }],
            diagnosisForm: {
                fullName: '', idNumber: '', contact: '', residential: '', referralSource: '',
                waistSymptoms: '', midSectionSymptoms: '', chestSymptoms: '', neckHeadSymptoms: '',
                specificTreatment: '', paymentCode: '', hasPaidDiagnosis: false
            },
            user: {
                id: null, name: '', email: '', phone: '', kabiru: 0, referralCode: '', personalLink: '',
                referredBy: '', treatments: [], referrals: 0, totalEarnings: 0, joinDate: ''
            },
            members: []
        };

        const navigationItems = [
            { id: 'home', icon: 'üè†', label: 'Home' },
            { id: 'products', icon: 'üì¶', label: 'Products & Services' },
            { id: 'diagnosis', icon: 'üìã', label: 'Live Diagnosis' },
            { id: 'therapy', icon: 'ü©∫', label: 'Treatment Therapy' },
            { id: 'payments', icon: 'üí≥', label: 'Payments' },
            { id: 'delivery', icon: 'üìÖ', label: 'Delivery' },
            { id: 'followups', icon: 'üìû', label: 'Follow-ups' },
            { id: 'protocol', icon: 'üìã', label: 'Treatment Protocol' },
            { id: 'account', icon: 'üë§', label: 'My Account' }
        ];

        const products = [
            'Auto-immune disorders', 'Weight & BMI', 'Hormones cure', 'First & 2nd stage cancers',
            'Natural birth control', 'Asthmatic best', 'Stomach health', 'Arthritis cure',
            'Teeth and gum', 'Skin care products', 'Wound products'
        ];

        // Authentication Functions
        function showSignup() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }

        function generateReferralCode(name) {
            const namePart = name.replace(/\s+/g, '').substring(0, 6).toUpperCase();
            const randomPart = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `AYUKA${namePart}${randomPart}`;
        }

        function generateUserId() {
            return 'USER_' + Date.now() + '_' + Math.random().toString(36).substring(2, 6);
        }

        function signup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const phone = document.getElementById('signup-phone').value;
            const password = document.getElementById('signup-password').value;
            const referralCode = document.getElementById('signup-referral').value;

            if (!name || !email || !phone || !password) {
                alert('Please fill in all required fields');
                return;
            }

            const savedMembers = localStorage.getItem('ayukaYamoMembers');
            if (savedMembers) state.members = JSON.parse(savedMembers);

            const existingUser = state.members.find(m => m.email === email || m.phone === phone);
            if (existingUser) {
                alert('Account already exists');
                return;
            }

            const userId = generateUserId();
            const userReferralCode = generateReferralCode(name);
            const personalLink = `https://ayukayamo.com/ref/${userReferralCode}`;

            const newUser = {
                id: userId, name: name, email: email, phone: phone,
                kabiru: referralCode ? 25 : 0, referralCode: userReferralCode,
                personalLink: personalLink, referredBy: referralCode || '',
                treatments: [], referrals: 0, totalEarnings: referralCode ? 25 : 0,
                joinDate: new Date().toISOString().split('T')[0]
            };

            if (referralCode) {
                const referrer = state.members.find(m => m.referralCode === referralCode);
                if (referrer) {
                    referrer.kabiru += 50;
                    referrer.referrals += 1;
                    referrer.totalEarnings += 50;
                }
            }

            state.members.push(newUser);
            state.user = newUser;
            state.isAuthenticated = true;
            state.showWelcome = true;

            localStorage.setItem('ayukaYamoUser', JSON.stringify(newUser));
            localStorage.setItem('ayukaYamoMembers', JSON.stringify(state.members));

            showMainApp();
        }

        function login() {
            const emailOrPhone = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!emailOrPhone || !password) {
                alert('Please enter credentials');
                return;
            }

            const savedMembers = localStorage.getItem('ayukaYamoMembers');
            if (savedMembers) state.members = JSON.parse(savedMembers);

            const user = state.members.find(m => m.email === emailOrPhone || m.phone === emailOrPhone);
            
            if (user) {
                state.user = user;
                state.isAuthenticated = true;
                localStorage.setItem('ayukaYamoUser', JSON.stringify(user));
                showMainApp();
            } else {
                alert('Account not found. Please sign up first.');
            }
        }

        function logout() {
            state.isAuthenticated = false;
            state.user = {};
            localStorage.removeItem('ayukaYamoUser');
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('auth-screen').classList.remove('hidden');
            closeMenu();
        }

        function showMainApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-greeting').textContent = `Hi ${state.user.name.split(' ')[0]}!`;
            
            if (state.showWelcome) {
                document.getElementById('welcome-guide').classList.remove('hidden');
            }
            
            renderContent();
            updateBottomNav();
            renderNavItems();
        }

        function closeWelcome() {
            document.getElementById('welcome-guide').classList.add('hidden');
            state.showWelcome = false;
        }

        function chooseProducts() {
            state.userChoice = 'products';
            setActiveTab('products');
        }

        function chooseTreatment() {
            state.userChoice = 'treatment';
            setActiveTab('therapy');
        }

        function showAdvertising() {
            document.getElementById('advertising-modal').classList.remove('hidden');
        }

        function closeAdvertising() {
            document.getElementById('advertising-modal').classList.add('hidden');
        }

        // Social Media Functions
        function shareToFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(state.user.personalLink)}`;
            window.open(url, '_blank');
            awardSocialPoints(20);
        }

        function shareToTwitter() {
            const text = `Join Ayuka Yamo for natural healing! ${state.user.personalLink}`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
            awardSocialPoints(15);
        }

        function shareToWhatsApp() {
            const text = `Join Ayuka Yamo for natural healing!\n${state.user.personalLink}`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
            awardSocialPoints(25);
        }

        function shareToInstagram() {
            const text = `Join Ayuka Yamo! Code: ${state.user.referralCode}\n${state.user.personalLink}`;
            navigator.clipboard.writeText(text);
            alert('Text copied for Instagram!');
            awardSocialPoints(20);
        }

        function awardSocialPoints(points) {
            state.user.kabiru += points;
            state.user.totalEarnings += points;
            updateUserData();
            alert(`You earned ${points} iKb points!`);
            closeAdvertising();
            renderContent();
        }

        function updateUserData() {
            localStorage.setItem('ayukaYamoUser', JSON.stringify(state.user));
            const memberIndex = state.members.findIndex(m => m.id === state.user.id);
            if (memberIndex !== -1) {
                state.members[memberIndex] = state.user;
                localStorage.setItem('ayukaYamoMembers', JSON.stringify(state.members));
            }
        }

        // UI Functions
        function toggleMenu() {
            state.isMenuOpen = !state.isMenuOpen;
            const menu = document.getElementById('sliding-menu');
            const menuIcon = document.getElementById('menu-icon');
            const closeIcon = document.getElementById('close-icon');
            
            if (state.isMenuOpen) {
                menu.classList.remove('hidden');
                menuIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
                menuIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
            }
        }

        function closeMenu() {
            state.isMenuOpen = false;
            document.getElementById('sliding-menu').classList.add('hidden');
            document.getElementById('menu-icon').classList.remove('hidden');
            document.getElementById('close-icon').classList.add('hidden');
        }

        function setActiveTab(tab) {
            state.activeTab = tab;
            closeMenu();
            renderContent();
            updateBottomNav();
        }

        function showConsultForm(productName) {
            state.selectedProduct = productName;
            document.getElementById('selected-product-name').textContent = productName;
            document.getElementById('consultation-modal').classList.remove('hidden');
            document.getElementById('consult-fullname').value = state.user.name;
            document.getElementById('consult-contact').value = state.user.phone;
            updateConsultSubmitButton();
        }

        function closeConsultForm() {
            document.getElementById('consultation-modal').classList.add('hidden');
        }

        function setUrgency(level) {
            state.selectedUrgency = level;
            ['Low', 'Medium', 'High'].forEach(l => {
                const btn = document.getElementById(`urgency-${l.toLowerCase()}`);
                if (btn) {
                    btn.className = l === level ? 
                        'border border-green-500 bg-green-50 text-green-700 rounded-lg p-2 text-sm' :
                        'border border-gray-300 rounded-lg p-2 text-sm hover:bg-gray-50';
                }
            });
        }

        function updateConsultSubmitButton() {
            const btn = document.getElementById('submit-consult-btn');
            const fullName = document.getElementById('consult-fullname')?.value || '';
            const contact = document.getElementById('consult-contact')?.value || '';
            
            if (btn) {
                if (fullName && contact) {
                    btn.disabled = false;
                    btn.className = 'w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700';
                } else {
                    btn.disabled = true;
                    btn.className = 'w-full bg-gray-400 text-white py-3 rounded-lg font-medium cursor-not-allowed';
                }
            }
        }

        function submitConsultation() {
            const fullName = document.getElementById('consult-fullname').value;
            const contact = document.getElementById('consult-contact').value;
            const doctor = document.getElementById('consult-doctor').value;
            const date = document.getElementById('consult-date').value;
            const time = document.getElementById('consult-time').value;
            const symptoms = document.getElementById('consult-symptoms').value;

            const emailBody = `Consultation Request:
Member: ${fullName} (${state.user.id})
Contact: ${contact}
Product: ${state.selectedProduct}
Doctor: ${doctor}
Date: ${date} ${time}
Symptoms: ${symptoms}
Urgency: ${state.selectedUrgency}`;

            window.open(`mailto:grouptauafrica@gmail.com?subject=Consultation - ${state.selectedProduct}&body=${encodeURIComponent(emailBody)}`);
            
            state.user.kabiru += 15;
            state.user.totalEarnings += 15;
            updateUserData();
            closeConsultForm();
            alert('Request sent! Earned 15 iKb points.');
            renderContent();
        }

        function buyProduct(productName) {
            const emailBody = `Product Purchase:
Member: ${state.user.name} (${state.user.id})
Email: ${state.user.email}
Phone: ${state.user.phone}
Product: ${productName}
Price: KSh 10,000
Referral Code: ${state.user.referralCode}`;

            window.open(`mailto:grouptauafrica@gmail.com?subject=Purchase - ${productName}&body=${encodeURIComponent(emailBody)}`);
            
            state.user.kabiru += 100;
            state.user.totalEarnings += 100;
            updateUserData();
            alert('Purchase request sent! Earned 100 iKb points.');
            renderContent();
        }

        function toggleChatbot() {
            const chatbot = document.getElementById('chatbot');
            state.showChatbot = !state.showChatbot;
            chatbot.classList.toggle('hidden');
            if (state.showChatbot) renderChatMessages();
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            state.chatMessages.push({ sender: 'user', message: message });
            input.value = '';
            renderChatMessages();
            
            setTimeout(() => {
                let botResponse = "I understand. Let me help you.";
                if (message.toLowerCase().includes('appointment')) {
                    botResponse = "I can help book an appointment. Which service interests you?";
                } else if (message.toLowerCase().includes('product')) {
                    botResponse = "Our products are KSh 10,000 each. Which condition?";
                } else if (message.toLowerCase().includes('referral')) {
                    botResponse = `Your code: ${state.user.referralCode}. Share to earn 50 iKb!`;
                }
                state.chatMessages.push({ sender: 'bot', message: botResponse });
                renderChatMessages();
            }, 1000);
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') sendChatMessage();
        }

        function renderChatMessages() {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            state.chatMessages.forEach(msg => {
                const div = document.createElement('div');
                div.className = `flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`;
                const messageDiv = document.createElement('div');
                messageDiv.className = `max-w-[70%] p-2 rounded-lg text-sm ${
                    msg.sender === 'user' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-800'
                }`;
                messageDiv.textContent = msg.message;
                div.appendChild(messageDiv);
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        }

        function payDiagnosisFee() {
            const paymentCode = 'AY' + Date.now().toString().slice(-6);
            alert(`Payment successful! Code: ${paymentCode}`);
            state.diagnosisForm.paymentCode = paymentCode;
            state.diagnosisForm.hasPaidDiagnosis = true;
            state.user.kabiru += 25;
            state.user.totalEarnings += 25;
            updateUserData();
            renderContent();
        }

        function submitDiagnosis() {
            if (!state.diagnosisForm.hasPaidDiagnosis) {
                alert('Please pay diagnosis fee first');
                return;
            }

            const form = state.diagnosisForm;
            const emailBody = `Diagnosis Submission:
Member: ${state.user.name} (${state.user.id})
Payment Code: ${form.paymentCode}
Contact: ${form.contact}
Symptoms: Waist: ${form.waistSymptoms}, Mid: ${form.midSectionSymptoms}, Chest: ${form.chestSymptoms}, Head: ${form.neckHeadSymptoms}`;

            window.open(`mailto:grouptauafrica@gmail.com?subject=Diagnosis - ${form.fullName}&body=${encodeURIComponent(emailBody)}`);
            
            state.user.kabiru += 25;
            state.user.totalEarnings += 25;
            updateUserData();
            alert('Diagnosis submitted! Earned 25 iKb points.');
            renderContent();
        }

        function updateDiagnosisForm(field, value) {
            state.diagnosisForm[field] = value;
            updateDiagnosisSubmitButton();
        }

        function updateDiagnosisSubmitButton() {
            const btn = document.getElementById('submit-diagnosis-btn');
            const form = state.diagnosisForm;
            if (btn) {
                if (form.fullName && form.idNumber && form.contact && form.residential && form.referralSource && form.hasPaidDiagnosis) {
                    btn.disabled = false;
                    btn.className = 'w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700';
                } else {
                    btn.disabled = true;
                    btn.className = 'w-full bg-gray-400 text-white py-3 rounded-lg font-medium cursor-not-allowed';
                }
            }
        }

        function copyReferralLink() {
            navigator.clipboard.writeText(state.user.personalLink);
            alert('Link copied!');
        }

        function shareReferralLink() {
            if (navigator.share) {
                navigator.share({
                    title: 'Join Ayuka Yamo',
                    url: state.user.personalLink
                });
            } else {
                copyReferralLink();
            }
        }

        // Render Functions
        function renderHome() {
            return `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-6 rounded-lg">
                        <h2 class="text-2xl font-bold mb-2">Welcome ${state.user.name}</h2>
                        <p class="text-green-100">Your holistic health journey starts here</p>
                        <div class="mt-4 flex items-center space-x-4">
                            <div class="bg-white/20 px-3 py-1 rounded-full">
                                <span class="text-sm">Kabiru: ${state.user.kabiru} iKb</span>
                            </div>
                            <div class="bg-white/20 px-3 py-1 rounded-full">
                                <span class="text-sm">Referrals: ${state.user.referrals}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white rounded-lg p-4">
                        <h3 class="font-semibold mb-2">Kabiru Mining Platform</h3>
                        <p class="text-blue-100 text-sm mb-3">Access blockchain mining and convert points to real money</p>
                        <button onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')" class="w-full bg-white text-blue-600 py-3 rounded-lg text-sm font-medium hover:bg-gray-100">
                            Kabiru Mining App
                        </button>
                    </div>

                    ${state.userChoice === 'products' ? `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-medium text-green-800 mb-2">Choice: Individual Products</h3>
                            <button onclick="setActiveTab('products')" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm">Browse Products</button>
                        </div>
                    ` : state.userChoice === 'treatment' ? `
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h3 class="font-medium text-purple-800 mb-2">Choice: Full Treatment</h3>
                            <button onclick="setActiveTab('therapy')" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm">Start Treatment</button>
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="setActiveTab('diagnosis')" class="bg-blue-50 border border-blue-200 p-4 rounded-lg text-center hover:bg-blue-100">
                            <div class="text-2xl mb-2">üìã</div>
                            <span class="text-sm font-medium text-blue-800">Start Diagnosis</span>
                        </button>
                        <button onclick="setActiveTab('therapy')" class="bg-purple-50 border border-purple-200 p-4 rounded-lg text-center hover:bg-purple-100">
                            <div class="text-2xl mb-2">ü©∫</div>
                            <span class="text-sm font-medium text-purple-800">Treatment Therapy</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderProducts() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Products & Services</h2>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <p class="text-sm text-green-800 font-medium">All products: KSh 10,000 each</p>
                        <p class="text-xs text-green-600">Earn 100 Kabiru points with each purchase!</p>
                    </div>
                    
                    <div class="grid gap-4">
                        ${products.map(product => `
                            <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-semibold text-gray-800">${product}</h3>
                                    <span class="text-green-600 font-bold text-sm">KSh 10,000</span>
                                </div>
                                <p class="text-gray-600 text-sm mb-3">Specialized treatment for ${product.toLowerCase()}</p>
                                <div class="flex space-x-2">
                                    <button onclick="showConsultForm('${product}')" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">Consult</button>
                                    <button onclick="buyProduct('${product}')" class="px-4 py-2 border border-green-600 text-green-600 rounded-lg text-sm hover:bg-green-50">Buy Now</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderTherapy() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Treatment Therapy</h2>
                    
                    <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg p-4">
                        <h3 class="font-semibold mb-2">Expert Consultation</h3>
                        <p class="text-purple-100 text-sm">Connect with certified doctors</p>
                    </div>
                    
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-4">Available Specialists</h3>
                        ${[
                            { name: 'HDr Magero Asa Rateng', specialty: 'Ayuka Yamo Therapies - Chronic conditions', available: 'Available Now', rating: 5.0 },
                            { name: 'HDr Kaigi', specialty: 'Maat Botanicals - Naturopathic treatments', available: 'Available Now', rating: 4.9 },
                            { name: 'HDr Orudi Aywak', specialty: 'Yath Tiyo - Beauty products', available: 'Available', rating: 4.9 },
                            { name: 'HDr Adenga Ayanga', specialty: 'Herbal Treatment, spiritual prayers', available: 'Available', rating: 4.8 },
                            { name: 'HDr Akoth Syambua', specialty: 'Traditional Treatment products', available: 'Available', rating: 4.8 }
                        ].map(doctor => `
                            <div class="mb-3 p-3 bg-gray-50 rounded-lg">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-medium text-gray-800">${doctor.name}</h4>
                                        <p class="text-sm text-gray-600">${doctor.specialty}</p>
                                        <span class="text-sm text-gray-600">Rating: ${doctor.rating}</span>
                                    </div>
                                    <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">${doctor.available}</span>
                                </div>
                                <button onclick="bookDoctor('${doctor.name}')" class="w-full bg-purple-600 text-white py-2 rounded-lg text-sm hover:bg-purple-700">Book Appointment</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderDiagnosis() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Live Diagnosis</h2>
                    
                    ${!state.diagnosisForm.hasPaidDiagnosis ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h3 class="font-medium text-yellow-800 mb-2">Fee Required</h3>
                            <p class="text-sm text-yellow-700 mb-3">Pay KSh 500 diagnosis fee</p>
                            <button onclick="payDiagnosisFee()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm">Pay KSh 500</button>
                        </div>
                    ` : `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                            <p class="text-sm text-green-800">Fee paid. Code: ${state.diagnosisForm.paymentCode}</p>
                        </div>
                    `}
                    
                    <div class="bg-white border border-gray-200 rounded-lg p-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                <input type="text" id="diag-fullname" class="w-full border border-gray-300 rounded-lg p-3" value="${state.user.name}" oninput="updateDiagnosisForm('fullName', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ID Number *</label>
                                <input type="text" id="diag-idnumber" class="w-full border border-gray-300 rounded-lg p-3" placeholder="National ID" oninput="updateDiagnosisForm('idNumber', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Contact *</label>
                                <input type="tel" id="diag-contact" class="w-full border border-gray-300 rounded-lg p-3" value="${state.user.phone}" oninput="updateDiagnosisForm('contact', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
                                <input type="text" id="diag-residential" class="w-full border border-gray-300 rounded-lg p-3" placeholder="Address" oninput="updateDiagnosisForm('residential', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">How did you hear about us? *</label>
                                <select id="diag-referral" class="w-full border border-gray-300 rounded-lg p-3" onchange="updateDiagnosisForm('referralSource', this.value)">
                                    <option value="">Select source</option>
                                    <option value="friend">Friend/Family</option>
                                    <option value="social">Social Media</option>
                                    <option value="google">Google</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Symptoms</label>
                                <textarea id="diag-symptoms" class="w-full border border-gray-300 rounded-lg p-3 h-24" placeholder="Describe all symptoms..." oninput="updateDiagnosisForm('waistSymptoms', this.value)"></textarea>
                            </div>
                            <button onclick="submitDiagnosis()" id="submit-diagnosis-btn" class="w-full bg-gray-400 text-white py-3 rounded-lg font-medium cursor-not-allowed" disabled>Submit</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAccount() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">My Account</h2>
                    
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-4">Profile</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Name:</span>
                                <span class="font-medium">${state.user.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Email:</span>
                                <span class="font-medium">${state.user.email}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Phone:</span>
                                <span class="font-medium">${state.user.phone}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg p-4">
                        <h3 class="font-semibold mb-3">Kabiru Points (iKb)</h3>
                        <div class="text-3xl font-bold mb-2">${state.user.kabiru} iKb</div>
                        <p class="text-purple-100 text-sm">Total earned: ${state.user.totalEarnings} iKb</p>
                        <p class="text-purple-200 text-xs mt-1">Cash value: KSh ${Math.floor(state.user.kabiru * 0.1)}</p>
                        
                        <div class="mt-4 p-3 bg-white/20 rounded-lg">
                            <p class="text-sm font-medium mb-2">Convert to Cash</p>
                            <p class="text-xs text-purple-100 mb-2">To convert Kabiru points to fiat cash, use the Kabiru Mining App wallet.</p>
                            <button onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')" class="text-xs bg-white text-purple-600 px-3 py-1 rounded-full">
                                Access Kabiru Wallet
                            </button>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-4">Referral Program</h3>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                            <p class="text-sm text-green-800 font-medium mb-2">Your Referral Link:</p>
                            <div class="flex items-center space-x-2">
                                <input type="text" value="${state.user.personalLink}" readonly class="flex-1 text-xs bg-white border rounded px-2 py-1">
                                <button onclick="copyReferralLink()" class="text-green-600">Copy</button>
                            </div>
                            <p class="text-xs text-green-600 mt-1">Code: ${state.user.referralCode}</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center">
                                <div class="font-bold text-2xl text-green-600">${state.user.referrals}</div>
                                <div class="text-sm text-gray-600">Referrals</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-2xl text-purple-600">${state.user.totalEarnings}</div>
                                <div class="text-sm text-gray-600">Total Earned</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="shareReferralLink()" class="bg-green-600 text-white py-2 rounded-lg text-sm">Share</button>
                            <button onclick="showAdvertising()" class="bg-orange-600 text-white py-2 rounded-lg text-sm">Advertise</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPayments() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Payments</h2>
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-4">Payment History</h3>
                        <div class="text-center py-4">
                            <p class="text-gray-500">No payments yet</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button class="bg-green-600 text-white p-4 rounded-lg font-medium">M-Pesa</button>
                        <button class="bg-blue-600 text-white p-4 rounded-lg font-medium">Card</button>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h4 class="font-medium text-purple-800 mb-2">Points Conversion</h4>
                        <p class="text-sm text-purple-700 mb-3">Points: ${state.user.kabiru} iKb ‚âà KSh ${Math.floor(state.user.kabiru * 0.1)}</p>
                        <div class="bg-white/60 p-3 rounded-lg">
                            <p class="text-xs text-purple-700 mb-2">To convert points to cash, use Kabiru Mining App wallet.</p>
                            <button onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')" class="text-xs bg-purple-600 text-white px-3 py-1 rounded-full">Access Wallet</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDelivery() {
            return `<div class="space-y-4"><h2 class="text-2xl font-bold text-gray-800">Delivery</h2><div class="bg-white border border-gray-200 rounded-lg p-4"><p class="text-gray-500 text-center py-4">No deliveries scheduled</p></div></div>`;
        }

        function renderFollowups() {
            return `<div class="space-y-4"><h2 class="text-2xl font-bold text-gray-800">Follow-ups</h2><div class="bg-white border border-gray-200 rounded-lg p-4"><p class="text-gray-500 text-center py-4">No follow-ups scheduled</p></div></div>`;
        }

        function renderProtocol() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800">Treatment Protocol</h2>
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-4">4-Stage Program</h3>
                        ${[
                            'Stage 1: 24 Days Cleaning (24 days)',
                            'Stage 2: Chronic Therapy (30-60 days)', 
                            'Stage 3: DNA Fixing (14 days)',
                            'Stage 4: Free Monitoring (1 year)'
                        ].map((stage, i) => `
                            <div class="p-3 rounded-lg border border-gray-300 bg-gray-50 mb-3">
                                <h4 class="font-semibold text-gray-800">${stage}</h4>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function bookDoctor(doctorName) {
            const emailBody = `Appointment Request:
Member: ${state.user.name}
Phone: ${state.user.phone}
Doctor: ${doctorName}`;
            window.open(`mailto:grouptauafrica@gmail.com?subject=Appointment - ${doctorName}&body=${encodeURIComponent(emailBody)}`);
            state.user.kabiru += 10;
            updateUserData();
            alert('Request sent! Earned 10 iKb.');
        }

        function renderContent() {
            const content = document.getElementById('main-content');
            let html = '';
            switch(state.activeTab) {
                case 'home': html = renderHome(); break;
                case 'products': html = renderProducts(); break;
                case 'diagnosis': html = renderDiagnosis(); break;
                case 'therapy': html = renderTherapy(); break;
                case 'payments': html = renderPayments(); break;
                case 'delivery': html = renderDelivery(); break;
                case 'followups': html = renderFollowups(); break;
                case 'protocol': html = renderProtocol(); break;
                case 'account': html = renderAccount(); break;
                default: html = renderHome();
            }
            content.innerHTML = html;
        }

        function updateBottomNav() {
            const nav = document.getElementById('bottom-nav');
            nav.innerHTML = navigationItems.slice(0, 4).map(item => `
                <button onclick="setActiveTab('${item.id}')" class="flex flex-col items-center p-2 rounded-lg ${
                    state.activeTab === item.id ? 'text-green-600 bg-green-50' : 'text-gray-600'
                }">
                    <span class="text-xl mb-1">${item.icon}</span>
                    <span class="text-xs">${item.label.split(' ')[0]}</span>
                </button>
            `).join('');
        }

        function renderNavItems() {
            const nav = document.getElementById('nav-items');
            nav.innerHTML = navigationItems.map(item => `
                <button onclick="setActiveTab('${item.id}')" class="w-full flex items-center space-x-3 p-3 rounded-lg text-left hover:bg-gray-100 ${
                    state.activeTab === item.id ? 'bg-green-100 text-green-800' : 'text-gray-700'
                }">
                    <span class="text-xl">${item.icon}</span>
                    <span>${item.label}</span>
                </button>
            `).join('');
        }

        function init() {
            const savedUser = localStorage.getItem('ayukaYamoUser');
            const savedMembers = localStorage.getItem('ayukaYamoMembers');
            
            if (savedMembers) state.members = JSON.parse(savedMembers);
            
            if (savedUser) {
                state.user = JSON.parse(savedUser);
                state.isAuthenticated = true;
                showMainApp();
            }
            
            renderChatMessages();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
